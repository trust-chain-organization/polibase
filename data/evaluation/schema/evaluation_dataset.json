{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Polibase Evaluation Dataset Schema",
  "description": "Schema for Polibase LLM evaluation datasets",
  "type": "object",
  "required": ["version", "task_type", "metadata", "test_cases"],
  "properties": {
    "version": {
      "type": "string",
      "description": "Dataset version in semver format",
      "pattern": "^\\d+\\.\\d+\\.\\d+$"
    },
    "task_type": {
      "type": "string",
      "description": "Type of evaluation task",
      "enum": [
        "minutes_division",
        "speaker_matching",
        "party_member_extraction",
        "conference_member_matching"
      ]
    },
    "metadata": {
      "type": "object",
      "description": "Dataset metadata",
      "required": ["created_at", "created_by", "description"],
      "properties": {
        "created_at": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 datetime when dataset was created"
        },
        "created_by": {
          "type": "string",
          "description": "Creator of the dataset"
        },
        "description": {
          "type": "string",
          "description": "Description of the dataset"
        },
        "tags": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Optional tags for categorization"
        },
        "source": {
          "type": "string",
          "description": "Source of the test data (e.g., URL, document name)"
        }
      }
    },
    "test_cases": {
      "type": "array",
      "description": "Array of test cases",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["id", "input", "expected_output"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Unique identifier for the test case"
          },
          "description": {
            "type": "string",
            "description": "Optional description of the test case"
          },
          "input": {
            "type": "object",
            "description": "Input data for the test case",
            "oneOf": [
              {
                "description": "Input for minutes_division task",
                "required": ["original_minutes"],
                "properties": {
                  "original_minutes": {
                    "type": "string",
                    "description": "Raw minutes text to be divided (MinutesProcessAgent.run parameter)"
                  },
                  "meeting_info": {
                    "type": "object",
                    "description": "Optional meeting metadata",
                    "properties": {
                      "meeting_date": {
                        "type": "string",
                        "format": "date"
                      },
                      "governing_body": {
                        "type": "string"
                      },
                      "conference": {
                        "type": "string"
                      }
                    }
                  }
                }
              },
              {
                "description": "Input for speaker_matching task (batch processing)",
                "required": ["speakers", "politician_candidates"],
                "properties": {
                  "speakers": {
                    "type": "array",
                    "description": "List of speakers extracted from minutes to match",
                    "items": {
                      "type": "object",
                      "required": ["id", "name", "is_politician"],
                      "properties": {
                        "id": {
                          "type": "integer",
                          "description": "Database ID of the speaker"
                        },
                        "name": {
                          "type": "string",
                          "description": "Speaker name from minutes"
                        },
                        "type": {
                          "type": ["string", "null"],
                          "description": "Speaker type (政治家、参考人、議長、政府職員)"
                        },
                        "political_party_name": {
                          "type": ["string", "null"],
                          "description": "Party name extracted from minutes (string)"
                        },
                        "position": {
                          "type": ["string", "null"],
                          "description": "Position or title (役職・肩書き)"
                        },
                        "is_politician": {
                          "type": "boolean",
                          "description": "Whether the speaker is a politician"
                        }
                      }
                    }
                  },
                  "politician_candidates": {
                    "type": "array",
                    "description": "List of politicians from database to match against",
                    "items": {
                      "type": "object",
                      "required": ["id", "name"],
                      "properties": {
                        "id": {
                          "type": "integer",
                          "description": "Database ID of the politician"
                        },
                        "name": {
                          "type": "string",
                          "description": "Politician name"
                        },
                        "political_party_id": {
                          "type": ["integer", "null"],
                          "description": "Political party ID (normalized)"
                        },
                        "position": {
                          "type": ["string", "null"],
                          "description": "Position (衆議院議員、参議院議員など)"
                        },
                        "prefecture": {
                          "type": ["string", "null"],
                          "description": "Prefecture (都道府県)"
                        },
                        "electoral_district": {
                          "type": ["string", "null"],
                          "description": "Electoral district (選挙区)"
                        },
                        "profile_url": {
                          "type": ["string", "null"],
                          "description": "Profile page URL"
                        },
                        "party_position": {
                          "type": ["string", "null"],
                          "description": "Party position (代表、幹事長など)"
                        },
                        "speaker_id": {
                          "type": ["integer", "null"],
                          "description": "Linked speaker ID if already matched"
                        }
                      }
                    }
                  }
                }
              },
              {
                "description": "Input for party_member_extraction task",
                "required": ["html_content"],
                "properties": {
                  "html_content": {
                    "type": "string",
                    "description": "HTML content of party member page"
                  },
                  "party_name": {
                    "type": "string"
                  },
                  "url": {
                    "type": "string",
                    "format": "uri"
                  }
                }
              },
              {
                "description": "Input for conference_member_matching task (batch processing)",
                "required": ["conference_members", "politician_candidates"],
                "properties": {
                  "conference_members": {
                    "type": "array",
                    "description": "List of conference members to match",
                    "items": {
                      "type": "object",
                      "required": ["member_id", "name", "party_affiliation"],
                      "properties": {
                        "member_id": {
                          "type": "string",
                          "description": "Unique identifier for the conference member"
                        },
                        "name": {
                          "type": "string",
                          "description": "Conference member name"
                        },
                        "party_affiliation": {
                          "type": "string",
                          "description": "Party or parliamentary group affiliation"
                        },
                        "role": {
                          "type": ["string", "null"],
                          "description": "Role in the conference"
                        },
                        "conference_id": {
                          "type": "integer",
                          "description": "Conference ID"
                        }
                      }
                    }
                  },
                  "politician_candidates": {
                    "type": "array",
                    "description": "List of politicians from database to match against",
                    "items": {
                      "type": "object",
                      "required": ["politician_id", "name"],
                      "properties": {
                        "politician_id": {
                          "type": "integer",
                          "description": "Database ID of the politician"
                        },
                        "name": {
                          "type": "string",
                          "description": "Politician name"
                        },
                        "party": {
                          "type": ["string", "null"],
                          "description": "Political party affiliation"
                        },
                        "district": {
                          "type": ["string", "null"],
                          "description": "Electoral district"
                        }
                      }
                    }
                  }
                }
              }
            ]
          },
          "expected_output": {
            "type": "object",
            "description": "Expected output for the test case",
            "oneOf": [
              {
                "description": "Output for minutes_division task (SpeakerAndSpeechContent list)",
                "required": ["speaker_and_speech_content_list"],
                "properties": {
                  "speaker_and_speech_content_list": {
                    "type": "array",
                    "description": "List of extracted speeches from MinutesProcessAgent",
                    "items": {
                      "type": "object",
                      "required": ["speaker", "speech_content", "speech_order"],
                      "properties": {
                        "speaker": {
                          "type": "string",
                          "description": "発言者名"
                        },
                        "speech_content": {
                          "type": "string",
                          "description": "発言内容"
                        },
                        "chapter_number": {
                          "type": "integer",
                          "description": "分割した文字列を前から順に割り振った番号",
                          "default": 1
                        },
                        "sub_chapter_number": {
                          "type": "integer",
                          "description": "再分割した場合の文字列番号",
                          "default": 1
                        },
                        "speech_order": {
                          "type": "integer",
                          "description": "発言順"
                        }
                      }
                    }
                  }
                }
              },
              {
                "description": "Output for speaker_matching task (batch processing)",
                "required": ["matches", "statistics"],
                "properties": {
                  "matches": {
                    "type": "array",
                    "description": "List of matching results for each speaker",
                    "items": {
                      "type": "object",
                      "required": [
                        "speaker_id",
                        "speaker_name",
                        "confidence_score",
                        "matching_method"
                      ],
                      "properties": {
                        "speaker_id": {
                          "type": "integer",
                          "description": "Speaker ID"
                        },
                        "speaker_name": {
                          "type": "string",
                          "description": "Speaker name"
                        },
                        "matched_politician_id": {
                          "type": ["integer", "null"],
                          "description": "Matched politician ID (null if no match)"
                        },
                        "matched_politician_name": {
                          "type": ["string", "null"],
                          "description": "Matched politician name"
                        },
                        "confidence_score": {
                          "type": "number",
                          "minimum": 0,
                          "maximum": 1,
                          "description": "Confidence score of the match"
                        },
                        "matching_method": {
                          "type": "string",
                          "enum": ["existing", "rule_based", "llm", "none"],
                          "description": "Method used for matching"
                        },
                        "match_reason": {
                          "type": "string",
                          "description": "Explanation of the matching decision"
                        }
                      }
                    }
                  },
                  "statistics": {
                    "type": "object",
                    "description": "Overall matching statistics",
                    "required": [
                      "total_speakers",
                      "politicians_only",
                      "matched"
                    ],
                    "properties": {
                      "total_speakers": {
                        "type": "integer",
                        "description": "Total number of speakers processed"
                      },
                      "politicians_only": {
                        "type": "integer",
                        "description": "Number of speakers identified as politicians"
                      },
                      "matched": {
                        "type": "integer",
                        "description": "Number of successfully matched politicians"
                      },
                      "no_match": {
                        "type": "integer",
                        "description": "Number of politicians with no match"
                      },
                      "rule_based_matches": {
                        "type": "integer",
                        "description": "Number of rule-based matches"
                      },
                      "llm_matches": {
                        "type": "integer",
                        "description": "Number of LLM-based matches"
                      },
                      "existing_links": {
                        "type": "integer",
                        "description": "Number of existing links used"
                      },
                      "match_rate": {
                        "type": "number",
                        "minimum": 0,
                        "maximum": 1,
                        "description": "Proportion of politicians successfully matched"
                      },
                      "avg_confidence": {
                        "type": "number",
                        "minimum": 0,
                        "maximum": 1,
                        "description": "Average confidence score across matches"
                      },
                      "processing_time_ms": {
                        "type": "integer",
                        "description": "Processing time in milliseconds (optional)"
                      }
                    }
                  }
                }
              },
              {
                "description": "Output for party_member_extraction task",
                "required": ["politicians"],
                "properties": {
                  "politicians": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "required": ["name", "party"],
                      "properties": {
                        "name": {
                          "type": "string"
                        },
                        "party": {
                          "type": "string"
                        },
                        "position": {
                          "type": "string"
                        },
                        "district": {
                          "type": "string"
                        },
                        "profile_url": {
                          "type": "string",
                          "format": "uri"
                        }
                      }
                    }
                  }
                }
              },
              {
                "description": "Output for conference_member_matching task (batch processing)",
                "required": ["matches", "statistics"],
                "properties": {
                  "matches": {
                    "type": "array",
                    "description": "List of matching results for each conference member",
                    "items": {
                      "type": "object",
                      "required": ["member_id", "match_status", "confidence"],
                      "properties": {
                        "member_id": {
                          "type": "string",
                          "description": "Conference member ID"
                        },
                        "politician_id": {
                          "type": ["integer", "null"],
                          "description": "Matched politician ID (null if no match or needs review)"
                        },
                        "match_status": {
                          "type": "string",
                          "enum": ["matched", "needs_review", "no_match"]
                        },
                        "confidence": {
                          "type": "number",
                          "minimum": 0,
                          "maximum": 1,
                          "description": "Confidence score of the match"
                        },
                        "match_reason": {
                          "type": "string",
                          "description": "Explanation of the matching decision"
                        },
                        "alternative_matches": {
                          "type": "array",
                          "description": "Alternative politician candidates for ambiguous cases",
                          "items": {
                            "type": "object",
                            "properties": {
                              "politician_id": {
                                "type": "integer"
                              },
                              "confidence": {
                                "type": "number",
                                "minimum": 0,
                                "maximum": 1
                              }
                            }
                          }
                        }
                      }
                    }
                  },
                  "statistics": {
                    "type": "object",
                    "description": "Overall matching statistics",
                    "required": [
                      "total_members",
                      "matched",
                      "needs_review",
                      "no_match",
                      "match_rate"
                    ],
                    "properties": {
                      "total_members": {
                        "type": "integer",
                        "description": "Total number of conference members processed"
                      },
                      "matched": {
                        "type": "integer",
                        "description": "Number of high-confidence matches"
                      },
                      "needs_review": {
                        "type": "integer",
                        "description": "Number of ambiguous matches requiring review"
                      },
                      "no_match": {
                        "type": "integer",
                        "description": "Number of members with no matching politician"
                      },
                      "match_rate": {
                        "type": "number",
                        "minimum": 0,
                        "maximum": 1,
                        "description": "Proportion of successfully matched members"
                      },
                      "avg_confidence": {
                        "type": "number",
                        "minimum": 0,
                        "maximum": 1,
                        "description": "Average confidence score across all matches"
                      },
                      "processing_time_ms": {
                        "type": "integer",
                        "description": "Processing time in milliseconds (optional)"
                      }
                    }
                  }
                }
              }
            ]
          },
          "evaluation_criteria": {
            "type": "object",
            "description": "Optional evaluation criteria for this test case",
            "properties": {
              "priority": {
                "type": "string",
                "enum": ["low", "medium", "high"],
                "description": "Priority of this test case"
              },
              "difficulty": {
                "type": "string",
                "enum": ["easy", "medium", "hard"],
                "description": "Difficulty level of this test case"
              },
              "notes": {
                "type": "string",
                "description": "Additional notes for evaluation"
              }
            }
          }
        }
      }
    }
  }
}
