global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    monitor: "sagebase-monitor"

# アラートマネージャーの設定
alerting:
  alertmanagers:
    - static_configs:
        - targets: []

# ルールファイルの読み込み
rule_files:
  - "alerts/*.yml"

# スクレイプ設定
scrape_configs:
  # Sagebaseアプリケーションのメトリクス
  - job_name: "sagebase-app"
    scrape_interval: 15s
    static_configs:
      - targets:
          - "sagebase:9090" # OpenTelemetryメトリクスエンドポイント
        labels:
          service: "sagebase"
          environment: "production"

  # Streamlit監視アプリのメトリクス
  - job_name: "sagebase-monitoring-app"
    scrape_interval: 15s
    static_configs:
      - targets:
          - "sagebase-monitoring:9090"
        labels:
          service: "sagebase-monitoring"
          environment: "production"

  # Prometheus自身のメトリクス
  - job_name: "prometheus"
    static_configs:
      - targets: ["localhost:9090"]

  # Node Exporterのメトリクス（システムリソース）
  - job_name: "node-exporter"
    static_configs:
      - targets: ["node-exporter:9100"]
        labels:
          instance: "sagebase-host"

  # PostgreSQL Exporterのメトリクス
  - job_name: "postgres"
    static_configs:
      - targets: ["postgres-exporter:9187"]
        labels:
          database: "sagebase_db"

  # Grafanaのメトリクス
  - job_name: "grafana"
    static_configs:
      - targets: ["grafana:3000"]

  # Lokiのメトリクス
  - job_name: "loki"
    static_configs:
      - targets: ["loki:3100"]
