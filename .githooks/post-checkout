#!/bin/bash

# Git post-checkout hook for Polibase project
# Automatically sets up Docker ports for git worktrees

# Only run on branch checkouts, not file checkouts
if [ "$3" != "1" ]; then
    exit 0
fi

# Get the current directory (worktree root)
WORKTREE_ROOT=$(git rev-parse --show-toplevel)

# Check if this is a worktree (not the main repository)
# In a worktree, .git is a file, not a directory
if [ -f "$WORKTREE_ROOT/.git" ]; then
    echo "ðŸ”§ Detected git worktree checkout at: $WORKTREE_ROOT"

    # Check if setup script exists
    SETUP_SCRIPT="$WORKTREE_ROOT/scripts/setup-worktree-ports.sh"
    if [ -f "$SETUP_SCRIPT" ]; then
        echo "ðŸš€ Setting up Docker ports for worktree..."
        cd "$WORKTREE_ROOT" && "$SETUP_SCRIPT"
    fi
fi

exit 0
