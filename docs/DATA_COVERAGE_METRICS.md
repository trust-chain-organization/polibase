# データカバレッジ指標定義

最終更新日: 2025-11-02

## 概要

このドキュメントは、Polibase のデータ閲覧ダッシュボードで表示するデータカバレッジ指標を定義します。これらの指標により、システム管理者とデータ分析者は、Polibase に蓄積されているデータの品質と範囲を包括的に理解できます。

## 指標の分類

指標は以下の4つのカテゴリに分類されます：

1. **データ入力率**: データの網羅性を測定
2. **紐付け率**: Speaker-Politician マッチングの精度を測定
3. **活動状況**: データの時系列的な分布と活動量を測定
4. **データ品質**: データの整合性と処理の信頼性を測定

---

## 1. データ入力率指標

データ入力率指標は、Polibase がどれだけの範囲のデータをカバーしているかを示します。

### 1.1 自治体カバレッジ率

**定義**: 登録されている自治体数 / 全国自治体数（1,966）

**重要性**: Polibase が日本全国の何パーセントの自治体をカバーしているかを示す基本的な指標です。

**計算式**:
```
自治体カバレッジ率 (%) = (organization_code が登録されている governing_bodies 数) / 1,966 × 100
```

**目標値**:
- 短期目標 (6ヶ月): 10% (約197自治体)
- 中期目標 (1年): 25% (約492自治体)
- 長期目標 (2年): 50% (約983自治体)

**表示方法**: パーセンテージと絶対数を並記
- 例: "15.2% (299 / 1,966 自治体)"

**SQL 実装**: `tmp/sql_queries_design_20251102.md` の 1.1 を参照

---

### 1.2 会議体保有自治体率

**定義**: 会議体を持つ自治体数 / 登録自治体数

**重要性**: 自治体が登録されているだけでなく、実際に会議体データが登録されているかを示します。

**計算式**:
```
会議体保有自治体率 (%) = (conferences を持つ governing_bodies 数) / (登録されている governing_bodies 数) × 100
```

**目標値**:
- 目標: 80% 以上（登録された自治体の大部分が会議体データを持つ）

**表示方法**: パーセンテージと絶対数を並記

**SQL 実装**: `tmp/sql_queries_design_20251102.md` の 1.2 を参照

---

### 1.3 会議体別会議数

**定義**: 各会議体に登録されている会議の数

**重要性**: どの会議体のデータが充実しているか、どの会議体のデータ入力が不足しているかを可視化します。

**表示方法**:
- 上位10会議体をテーブルまたは棒グラフで表示
- 会議体名、自治体名、組織種別、会議数を表示

**SQL 実装**: `tmp/sql_queries_design_20251102.md` の 1.3 を参照

---

### 1.4 議事録処理完了率

**定義**: 処理完了した議事録数 / 全議事録数

**重要性**: 登録された議事録が実際に処理（分割・発言抽出）されているかを示します。処理が完了していない議事録は、発言データとして活用できません。

**計算式**:
```
議事録処理完了率 (%) = (processed_at IS NOT NULL の minutes 数) / (全 minutes 数) × 100
```

**目標値**:
- 目標: 95% 以上（ほぼすべての議事録が処理済み）
- 警告レベル: 80% 未満（処理の遅れが発生している）

**表示方法**: パーセンテージ、処理済み数、未処理数を並記
- 例: "92.3% (1,234 / 1,337 議事録) - 未処理: 103"

**SQL 実装**: `tmp/sql_queries_design_20251102.md` の 1.4 を参照

---

### 1.5 政党別政治家数

**定義**: 各政党に所属する政治家の数

**重要性**: どの政党のデータが充実しているか、政党間のバランスを確認できます。

**表示方法**:
- 政党名と政治家数を降順にテーブル表示
- 円グラフまたは棒グラフで視覚化

**SQL 実装**: `tmp/sql_queries_design_20251102.md` の 1.5 を参照

---

## 2. 紐付け率指標

紐付け率指標は、発言者（Speaker）と政治家（Politician）のマッチングがどれだけ正確に行われているかを示します。この紐付けが正確でないと、政治家の発言を追跡できません。

### 2.1 Speaker-Politician 全体マッチング率

**定義**: 政治家に紐付けされた speaker の数 / 全 speaker 数

**重要性**: Speaker データが Politician データに紐付けられている割合を示す基本指標です。

**計算式**:
```
全体マッチング率 (%) = (politician_id IS NOT NULL の speakers 数) / (全 speakers 数) × 100
```

**目標値**:
- 目標: 70% 以上
- 警告レベル: 50% 未満（マッチングの精度が低い）

**表示方法**: パーセンテージ、マッチ済み数、未マッチ数を並記
- 例: "75.4% (532 / 706 speakers) - 未マッチ: 174"

**SQL 実装**: `tmp/sql_queries_design_20251102.md` の 2.1 を参照

---

### 2.2 政治家 Speaker のマッチング率

**定義**: is_politician=TRUE の speaker の紐付け率

**重要性**: 政治家として分類された speaker が実際に politician に紐付けられているかを示します。is_politician=TRUE なのに politician_id が NULL の場合は、マッチングアルゴリズムの改善が必要です。

**計算式**:
```
政治家 Speaker マッチング率 (%) = (politician_id IS NOT NULL かつ is_politician=TRUE の speakers 数) / (is_politician=TRUE の speakers 数) × 100
```

**目標値**:
- 目標: 90% 以上（政治家として分類されたほとんどが紐付け済み）
- 警告レベル: 70% 未満（マッチングロジックの見直しが必要）

**表示方法**: パーセンテージと絶対数を並記

**SQL 実装**: `tmp/sql_queries_design_20251102.md` の 2.2 を参照

---

### 2.3 会議毎の紐付け率分布

**定義**: 各会議における speaker-politician 紐付け率

**重要性**: 会議ごとにマッチング精度がどのように分布しているかを把握できます。マッチング率が低い会議を特定し、個別に対応できます。

**表示方法**:
- マッチング率が低い会議（50%未満）を優先的にテーブル表示
- ヒストグラムで分布を可視化

**SQL 実装**: `tmp/sql_queries_design_20251102.md` の 2.3 を参照

---

### 2.4 紐付け率の統計サマリー

**定義**: 会議毎の紐付け率の統計情報（平均、中央値、最小、最大）

**重要性**: マッチング精度の全体的な傾向を把握できます。

**表示方法**:
- 平均マッチング率
- 中央値マッチング率
- 最小/最大マッチング率
- 100%マッチの会議数
- 80%以上マッチの会議数

**SQL 実装**: `tmp/sql_queries_design_20251102.md` の 2.4 を参照

---

## 3. 活動状況指標

活動状況指標は、データの時系列的な分布と、各エンティティの活動量を示します。

### 3.1 月別会議数推移

**定義**: 各月の会議数

**重要性**: 会議データの登録がどの時期に集中しているか、時系列的なトレンドを把握できます。

**表示方法**:
- 折れ線グラフまたは棒グラフで時系列表示
- 直近12ヶ月を強調表示

**SQL 実装**: `tmp/sql_queries_design_20251102.md` の 3.1 を参照

---

### 3.2 年別会議数推移

**定義**: 各年の会議数

**重要性**: 年単位での会議データの蓄積状況を把握できます。

**表示方法**: 棒グラフで年別に表示

**SQL 実装**: `tmp/sql_queries_design_20251102.md` の 3.2 を参照

---

### 3.3 政党別発言数

**定義**: 各政党所属の政治家の発言数

**重要性**: 各政党の発言データがどれだけ蓄積されているか、政党間のバランスを確認できます。

**表示方法**:
- 政党名、発言数、政治家数、1人あたり平均発言数を表示
- 棒グラフで視覚化

**SQL 実装**: `tmp/sql_queries_design_20251102.md` の 3.3 を参照

---

### 3.4 会議体別発言数

**定義**: 各会議体での発言数

**重要性**: どの会議体のデータが充実しているかを把握できます。

**表示方法**:
- 会議体名、自治体名、発言数、会議数、1会議あたり平均発言数を表示
- 上位20会議体を表示

**SQL 実装**: `tmp/sql_queries_design_20251102.md` の 3.4 を参照

---

### 3.5 組織種別別の活動状況

**定義**: 国、都道府県、市町村別の活動状況

**重要性**: 組織レベルでのデータカバレッジを比較できます。

**表示方法**:
- 組織種別、自治体数、会議体数、会議数、議事録数、発言数を表示
- 1自治体あたりの平均会議数を表示

**SQL 実装**: `tmp/sql_queries_design_20251102.md` の 3.5 を参照

---

## 4. データ品質指標

データ品質指標は、データの整合性と処理の信頼性を示します。

### 4.1 未処理議事録数

**定義**: processed_at が NULL の議事録数

**重要性**: 処理待ちの議事録がどれだけあるかを示します。この数が多い場合は、処理パイプラインのキャパシティを増やす必要があります。

**表示方法**:
- 未処理議事録数
- 最古の未処理議事録の登録日
- 最新の未処理議事録の登録日

**目標値**:
- 目標: 100件以下
- 警告レベル: 500件以上

**SQL 実装**: `tmp/sql_queries_design_20251102.md` の 4.1 を参照

---

### 4.2 処理日時別の議事録処理状況

**定義**: 処理日別の議事録処理数

**重要性**: 処理パイプラインが安定して稼働しているかを確認できます。

**表示方法**:
- 直近30日の処理数を折れ線グラフで表示
- 処理数が0の日を強調表示

**SQL 実装**: `tmp/sql_queries_design_20251102.md` の 4.2 を参照

---

### 4.3 LLM 処理のエラー発生率

**定義**: status が 'failed' の処理数 / 全処理数

**重要性**: LLM を使用した処理（議事録分割、speaker マッチングなど）の信頼性を示します。

**計算式**:
```
エラー発生率 (%) = (status='failed' の llm_processing_history 数) / (全 llm_processing_history 数) × 100
```

**目標値**:
- 目標: 5% 以下
- 警告レベル: 15% 以上

**表示方法**:
- エラー率、成功率、完了数、失敗数、進行中数、保留中数を表示

**SQL 実装**: `tmp/sql_queries_design_20251102.md` の 4.3 を参照

---

### 4.4 処理タイプ別の LLM エラー率

**定義**: 処理タイプ別の成功率とエラー率

**重要性**: どの処理タイプでエラーが多発しているかを特定できます。

**表示方法**:
- 処理タイプ、総処理数、成功数、失敗数、エラー率、成功率を表示
- エラー率が高い処理タイプを強調表示

**SQL 実装**: `tmp/sql_queries_design_20251102.md` の 4.4 を参照

---

### 4.5 LLM 処理の平均処理時間

**定義**: 完了した処理の平均処理時間（秒）

**重要性**: 処理パフォーマンスを監視し、パフォーマンス劣化を早期に検知できます。

**表示方法**:
- 処理タイプ別に平均処理時間、最小処理時間、最大処理時間を表示

**SQL 実装**: `tmp/sql_queries_design_20251102.md` の 4.5 を参照

---

### 4.6 データ整合性チェック: 発言と発言者の紐付け

**定義**: speaker_id が NULL の conversation 数

**重要性**: 発言に発言者が紐付けられていない場合、データの整合性に問題があります。

**表示方法**:
- 紐付けなし発言数と割合を表示

**目標値**:
- 目標: 5% 以下
- 警告レベル: 15% 以上

**SQL 実装**: `tmp/sql_queries_design_20251102.md` の 4.6 を参照

---

### 4.7 データ整合性チェック: 会議と議事録の紐付け

**定義**: minutes を持たない meeting 数

**重要性**: 会議が登録されているのに議事録がない場合、データの整合性に問題があります。

**表示方法**:
- 議事録なし会議数と割合を表示

**目標値**:
- 目標: 10% 以下（一部の会議は議事録が公開されていない可能性がある）

**SQL 実装**: `tmp/sql_queries_design_20251102.md` の 4.7 を参照

---

## 5. ダッシュボード設計ガイドライン

### 5.1 全体概要セクション

ダッシュボードの最上部に、以下の主要指標を大きく表示します：

**主要 KPI カード**:
1. 自治体カバレッジ率
2. 議事録処理完了率
3. Speaker-Politician マッチング率
4. LLM エラー発生率

各カードには以下を表示：
- 指標名
- 現在値（パーセンテージ）
- 絶対数
- 前月比または前週比（可能であれば）
- 目標値との差異を色で表現（緑: 目標達成、黄: 注意、赤: 警告）

**SQL 実装**: `tmp/sql_queries_design_20251102.md` の 5.1 を参照

---

### 5.2 セクション構成

ダッシュボードは以下のセクションで構成することを推奨します：

1. **概要セクション** (Overview)
   - 主要 KPI カード（4つ）
   - データ更新日時

2. **データ入力率セクション** (Data Coverage)
   - 自治体カバレッジ率
   - 会議体保有自治体率
   - 会議体別会議数（上位10）
   - 議事録処理完了率
   - 政党別政治家数

3. **紐付け率セクション** (Matching Quality)
   - Speaker-Politician 全体マッチング率
   - 政治家 Speaker のマッチング率
   - 会議毎の紐付け率分布（ヒストグラム）
   - 紐付け率の統計サマリー
   - マッチング率が低い会議のリスト（上位20）

4. **活動状況セクション** (Activity Trends)
   - 月別会議数推移（折れ線グラフ）
   - 年別会議数推移（棒グラフ）
   - 政党別発言数（棒グラフ）
   - 会議体別発言数（上位20）
   - 組織種別別の活動状況

5. **データ品質セクション** (Data Quality)
   - 未処理議事録数
   - 処理日時別の議事録処理状況（折れ線グラフ）
   - LLM 処理のエラー発生率
   - 処理タイプ別の LLM エラー率
   - LLM 処理の平均処理時間
   - データ整合性チェック（発言と発言者、会議と議事録）

---

### 5.3 色とアラートの使用ガイドライン

**色の使い分け**:
- 緑 (Green): 目標達成、良好な状態
- 黄 (Yellow): 注意が必要、目標に近づいているが達していない
- 赤 (Red): 警告レベル、即座の対応が必要

**アラート基準**:
- 自治体カバレッジ率: 緑 ≥ 25%, 黄 10-24%, 赤 < 10%
- 議事録処理完了率: 緑 ≥ 95%, 黄 80-94%, 赤 < 80%
- Speaker マッチング率: 緑 ≥ 70%, 黄 50-69%, 赤 < 50%
- LLM エラー発生率: 緑 ≤ 5%, 黄 6-14%, 赤 ≥ 15%

---

## 6. 実装の優先順位

### フェーズ1（必須指標）: 最初に実装すべき指標

1. 全体概要サマリー（5.1）
2. 自治体カバレッジ率（1.1）
3. 議事録処理完了率（1.4）
4. Speaker-Politician 全体マッチング率（2.1）
5. LLM 処理のエラー発生率（4.3）

### フェーズ2（重要指標）: 次に実装すべき指標

1. 会議体保有自治体率（1.2）
2. 政党別政治家数（1.5）
3. 政治家 Speaker のマッチング率（2.2）
4. 月別会議数推移（3.1）
5. 未処理議事録数（4.1）
6. データ整合性チェック（4.6, 4.7）

### フェーズ3（詳細分析）: 追加で実装する指標

1. 会議体別会議数（1.3）
2. 会議毎の紐付け率分布（2.3）
3. 紐付け率の統計サマリー（2.4）
4. 年別会議数推移（3.2）
5. 政党別発言数（3.3）
6. 会議体別発言数（3.4）
7. 組織種別別の活動状況（3.5）
8. 処理日時別の議事録処理状況（4.2）
9. 処理タイプ別の LLM エラー率（4.4）
10. LLM 処理の平均処理時間（4.5）

---

## 7. メンテナンスとレビュー

### 定期レビューサイクル

- **週次**: フェーズ1の必須指標を確認し、異常値があればアラートを発行
- **月次**: フェーズ2の重要指標を含めた包括的なレビュー
- **四半期**: すべての指標を確認し、目標値の見直しを実施

### 指標の見直しタイミング

- データ量が大幅に増加した場合（例: 登録自治体数が2倍になった場合）
- 新機能が追加された場合（例: 新しい処理タイプが追加された場合）
- 目標値が古くなった場合（例: 目標が達成されて新しい目標が必要な場合）

---

## 8. 参考資料

- **SQL 実装詳細**: `tmp/sql_queries_design_20251102.md`
- **データベーススキーマ**: `database/init.sql`
- **マイグレーション履歴**: `database/migrations/`
- **エンティティ定義**: `src/domain/entities/`

---

## 変更履歴

| 日付 | バージョン | 変更内容 | 担当者 |
|------|-----------|---------|--------|
| 2025-11-02 | 1.0 | 初版作成 | Claude Code |
